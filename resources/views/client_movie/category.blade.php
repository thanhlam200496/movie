@extends('client_movie.layouts.default')
@section('title')
    Capy Phim | Danh mục phim - xem phim hay, miễn phí, phim gì cũng có.
@endsection

@section('description')
    Xem phim online chất lượng cao, cập nhật mỗi ngày, tốc độ nhanh. Kho phim mới nhất, đầy đủ thể loại: hành động, tình
    cảm, hoạt hình, kinh dị...!
@endsection
@section('keywords')
    xem phim online, phim mới, phim chiếu rạp
@endsection
@push('style')
    <style>
        .site-header {
            margin-bottom: 50px
        }
    </style>
@endpush
@section('content')
    <div id="content" class="site-content">
        <div class="jws-title-bar-wrap">

            <div data-elementor-type="wp-post" data-elementor-id="4695" class="elementor elementor-4695">
                <section
                    class="elementor-section elementor-top-section elementor-element elementor-element-7526d41 elementor-section-full_width elementor-section-height-default elementor-section-height-default"
                    data-id="7526d41" data-element_type="section">
                    <div class="elementor-container elementor-column-gap-default jws_section_">
                        <div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-1469ffc"
                            data-id="1469ffc" data-element_type="column">
                            <div class="elementor-widget-wrap elementor-element-populated">
                                <div class="elementor-element elementor-element-26a22fc elementor-widget elementor-widget-jws_widget_heading"
                                    data-id="26a22fc" data-element_type="widget"
                                    data-widget_type="jws_widget_heading.default">
                                    <div class="elementor-widget-container">
                                        <div class="title-wrapper ">
                                            <h1 class="title">Action</h1>
                                        </div>
                                    </div>
                                </div>
                                <div class="elementor-element elementor-element-05ff6de elementor-widget elementor-widget-jws-breadcrumbs"
                                    data-id="05ff6de" data-element_type="widget" data-widget_type="jws-breadcrumbs.default">
                                    <div class="elementor-widget-container">

                                        <ul class="jws-breadcrumbs" itemscope=""
                                            itemtype="http://schema.org/BreadcrumbList">

                                            <li class="jws-breadcrumbs__item jws-breadcrumbs__item--home"
                                                itemprop="itemListElement" position="0" itemscope=""
                                                itemtype="http://schema.org/ListItem">
                                                <a class="jws-breadcrumbs__crumb jws-breadcrumbs__crumb--link jws-breadcrumbs__crumb--home"
                                                    itemprop="item" rel="v:url" property="v:title"
                                                    href="../../index.html" title="Home">
                                                    <span itemprop="name" class="jws-breadcrumbs__text">
                                                        Home </span>
                                                </a>
                                            </li>
                                            <li class="jws-breadcrumbs__separator"><span
                                                    class="jws-breadcrumbs__separator__text">/</span></li>
                                            <li class="jws-breadcrumbs__item jws-breadcrumbs__item--parent jws-breadcrumbs__item--post-type-archive jws-breadcrumbs__item--post-type-archive-movies"
                                                itemprop="itemListElement" position="1" itemscope=""
                                                itemtype="http://schema.org/ListItem">
                                                <a href="../../movie/index.html" class="jws-breadcrumbs__crumb"
                                                    itemprop="item" rel="v:url" property="v:title">
                                                    <span itemprop="name" class="jws-breadcrumbs__text">
                                                        Movies </span>
                                                </a>
                                            </li>
                                            <li class="jws-breadcrumbs__separator jws-breadcrumbs__separator"><span
                                                    class="jws-breadcrumbs__separator__text">/</span></li>
                                            <li class="jws-breadcrumbs__item jws-breadcrumbs__item--current jws-breadcrumbs__item--custom-tax-archive jws-breadcrumbs__item--custom-tax-archive-movies"
                                                itemprop="itemListElement" position="" itemscope=""
                                                itemtype="http://schema.org/ListItem">
                                                <span class="jws-breadcrumbs__crumb" itemprop="item" rel="v:url"
                                                    property="v:title">
                                                    <span itemprop="name" class="jws-breadcrumbs__text">
                                                        Action </span>
                                                </span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>





                    </div>
                </section>
            </div>
        </div>
        <div id="primary" class="content-area">
            <main id="main" class="site-main jws-movies-archive jws-movies_advanced-element sidebar-left">
                <div class="container">
                    <div class="row">
                        <div class="post_sidebar sidebar-has_sidebar col-xl-2 col-lg-12 col-12">

                            <div class="main-sidebar jws_sticky_move">
                                <div class="jws-filter-modal">
                                    <div class="modal-overlay"></div>
                                    <div class="siderbar-inner jws-scrollbar modal-content sidebar">
                                        <div class="modal-top">
                                            <span class="modal-title">FILTERS</span>
                                            <span class="modal-close">Close</span>
                                        </div>
                                        <style id="elementor-post-4684">
                                            .elementor-widget-heading .elementor-heading-title {
                                                font-family: var(--e-global-typography-primary-font-family), Sans-serif;
                                                font-weight: var(--e-global-typography-primary-font-weight);
                                                color: var(--e-global-color-primary);
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-de353e3>.elementor-widget-container {
                                                margin: 0px 0px -3px 0px;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-de353e3 .elementor-heading-title {
                                                font-family: var(--e-global-typography-secondary-font-family), Sans-serif;
                                                font-weight: var(--e-global-typography-secondary-font-weight);
                                                color: var(--e-global-color-secondary);
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-3915054>.elementor-widget-container {
                                                margin: 0px 0px 52px 0px;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-5378429>.elementor-widget-container {
                                                margin: 0px 0px 4px 0px;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-5378429 .elementor-heading-title {
                                                font-family: var(--e-global-typography-secondary-font-family), Sans-serif;
                                                font-weight: var(--e-global-typography-secondary-font-weight);
                                                color: var(--e-global-color-secondary);
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-9365ef2>.elementor-widget-container {
                                                margin: 0px 0px 50px 0px;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-54aa582>.elementor-widget-container {
                                                margin: 0px 0px 5px 0px;
                                                padding: 0px 0px 15px 0px;
                                                border-style: solid;
                                                border-width: 0px 0px 1px 0px;
                                                border-color: #FFFFFF1A;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-54aa582 .elementor-heading-title {
                                                font-family: var(--e-global-typography-secondary-font-family), Sans-serif;
                                                font-weight: var(--e-global-typography-secondary-font-weight);
                                                color: var(--e-global-color-secondary);
                                            }
                                        </style>
                                        <style>
                                            .elementor-widget-heading .elementor-heading-title {
                                                font-family: var(--e-global-typography-primary-font-family), Sans-serif;
                                                font-weight: var(--e-global-typography-primary-font-weight);
                                                color: var(--e-global-color-primary);
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-de353e3>.elementor-widget-container {
                                                margin: 0px 0px -3px 0px;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-de353e3 .elementor-heading-title {
                                                font-family: var(--e-global-typography-secondary-font-family), Sans-serif;
                                                font-weight: var(--e-global-typography-secondary-font-weight);
                                                color: var(--e-global-color-secondary);
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-3915054>.elementor-widget-container {
                                                margin: 0px 0px 52px 0px;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-5378429>.elementor-widget-container {
                                                margin: 0px 0px 4px 0px;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-5378429 .elementor-heading-title {
                                                font-family: var(--e-global-typography-secondary-font-family), Sans-serif;
                                                font-weight: var(--e-global-typography-secondary-font-weight);
                                                color: var(--e-global-color-secondary);
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-9365ef2>.elementor-widget-container {
                                                margin: 0px 0px 50px 0px;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-54aa582>.elementor-widget-container {
                                                margin: 0px 0px 5px 0px;
                                                padding: 0px 0px 15px 0px;
                                                border-style: solid;
                                                border-width: 0px 0px 1px 0px;
                                                border-color: #FFFFFF1A;
                                            }

                                            .elementor-4684 .elementor-element.elementor-element-54aa582 .elementor-heading-title {
                                                font-family: var(--e-global-typography-secondary-font-family), Sans-serif;
                                                font-weight: var(--e-global-typography-secondary-font-weight);
                                                color: var(--e-global-color-secondary);
                                            }
                                        </style>
                                        <div data-elementor-type="wp-post" data-elementor-id="4684"
                                            class="elementor elementor-4684">
                                            <section
                                                class="elementor-section elementor-top-section elementor-element elementor-element-00fca6d elementor-section-boxed elementor-section-height-default elementor-section-height-default"
                                                data-id="00fca6d" data-element_type="section">
                                                <div class="elementor-container elementor-column-gap-no jws_section_">
                                                    <div class="elementor-column elementor-col-100 elementor-top-column elementor-element elementor-element-97ea137"
                                                        data-id="97ea137" data-element_type="column">
                                                        <div class="elementor-widget-wrap elementor-element-populated">
                                                            <div class="elementor-element elementor-element-de353e3 elementor-widget elementor-widget-heading"
                                                                data-id="de353e3" data-element_type="widget"
                                                                data-widget_type="heading.default">
                                                                <div class="elementor-widget-container">
                                                                    <h5
                                                                        class="elementor-heading-title elementor-size-default">
                                                                        Thể Loại</h5>
                                                                </div>
                                                            </div>
                                                            <div class="elementor-element elementor-element-3915054 elementor-widget elementor-widget-jws_post_category_filter"
                                                                data-id="3915054" data-element_type="widget"
                                                                data-widget_type="jws_post_category_filter.default">
                                                                <div class="elementor-widget-container">

                                                                    <div class="jws-post-category-filter">

                                                                        <ul class="reset_ul_ol">

                                                                            <li class="cat-item current">
                                                                                <a rel="nofollow" href="index.html">
                                                                                    <span>Action</span>
                                                                                </a>
                                                                            </li>

                                                                            @foreach ($categories as $category)
                                                                                <li class="cat-item">
                                                                                    <a rel="nofollow"
                                                                                        href="../adventure/index.html">
                                                                                        <span>{{ $category->name }}</span>
                                                                                    </a>
                                                                                </li>
                                                                            @endforeach



                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../anime/index.html">
                                                                                    <span>Anime</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../comedy/index.html">
                                                                                    <span>Comedy</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../crime/index.html">
                                                                                    <span>Crime</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../documentary/index.html">
                                                                                    <span>Documentary</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../drama/index.html">
                                                                                    <span>Drama</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../family/index.html">
                                                                                    <span>Family</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../history/index.html">
                                                                                    <span>History</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../horror/index.html">
                                                                                    <span>Horror</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../romance/index.html">
                                                                                    <span>Romance</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../sci-fi/index.html">
                                                                                    <span>Sci-Fi</span>
                                                                                </a>
                                                                            </li>


                                                                            <li class="cat-item">
                                                                                <a rel="nofollow"
                                                                                    href="../thriller/index.html">
                                                                                    <span>Thriller</span>
                                                                                </a>
                                                                            </li>

                                                                        </ul>


                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div class="elementor-element elementor-element-5378429 elementor-widget elementor-widget-heading"
                                                                data-id="5378429" data-element_type="widget"
                                                                data-widget_type="heading.default">
                                                                <div class="elementor-widget-container">
                                                                    <h5
                                                                        class="elementor-heading-title elementor-size-default">
                                                                        Movies by year</h5>
                                                                </div>
                                                            </div>
                                                            <div class="elementor-element elementor-element-9365ef2 elementor-widget elementor-widget-jws_post_years_filter"
                                                                data-id="9365ef2" data-element_type="widget"
                                                                data-widget_type="jws_post_years_filter.default">
                                                                <div class="elementor-widget-container">

                                                                    <div class="jws-post-years-filter">


                                                                        <ul class="reset_ul_ol jws-filter-list">
                                                                            <li><a rel="nofollow" class="fs-small"
                                                                                    href="index61a9.html?years=2016">2016</a>
                                                                            </li>
                                                                            <li><a rel="nofollow" class="fs-small"
                                                                                    href="index4fc0.html?years=2017">2017</a>
                                                                            </li>
                                                                            <li><a rel="nofollow" class="fs-small"
                                                                                    href="indexc46f.html?years=2018">2018</a>
                                                                            </li>
                                                                            <li><a rel="nofollow" class="fs-small"
                                                                                    href="index306e.html?years=2019">2019</a>
                                                                            </li>
                                                                            <li><a rel="nofollow" class="fs-small"
                                                                                    href="index7ab9.html?years=2020">2020</a>
                                                                            </li>
                                                                            <li><a rel="nofollow" class="fs-small"
                                                                                    href="index03ec.html?years=2021">2021</a>
                                                                            </li>
                                                                            <li><a rel="nofollow" class="fs-small"
                                                                                    href="index50fe.html?years=2022">2022</a>
                                                                            </li>
                                                                            <li><a rel="nofollow" class="fs-small"
                                                                                    href="indexaecc.html?years=2023">2023</a>
                                                                            </li>
                                                                        </ul>


                                                                    </div>

                                                                </div>
                                                            </div>
                                                            <div class="elementor-element elementor-element-54aa582 elementor-widget elementor-widget-heading"
                                                                data-id="54aa582" data-element_type="widget"
                                                                data-widget_type="heading.default">
                                                                <div class="elementor-widget-container">
                                                                    <h5
                                                                        class="elementor-heading-title elementor-size-default">
                                                                        Top 5 Movies</h5>
                                                                </div>
                                                            </div>
                                                            <div class="elementor-element elementor-element-86c8b20 elementor-widget elementor-widget-jws_top_videos"
                                                                data-id="86c8b20" data-element_type="widget"
                                                                data-widget_type="jws_top_videos.default">
                                                                <div class="elementor-widget-container">
                                                                    <div class="jws-top-videos-tabs-element">

                                                                        <div class="top-videos-content row layout2">

                                                                            <div
                                                                                class="top-videos-item col-xl-12 col-lg-12 col-12">
                                                                                <div class="top-videos-inner">

                                                                                    <div class="top-number h5">

                                                                                        1
                                                                                    </div>
                                                                                    <div class="top-images">

                                                                                        <a
                                                                                            href="../../movie/spacex/index.html">
                                                                                            <img class='attachment-50x70 size-50x70'
                                                                                                alt=''
                                                                                                src="{{ asset('clients/wp-content/uploads/2023/06/spacex-50x70.jpg') }}">
                                                                                        </a>

                                                                                    </div>
                                                                                    <div class="top-content">
                                                                                        <div class="video-years">
                                                                                            2022</div>
                                                                                        <h6>
                                                                                            <a
                                                                                                href="../../movie/spacex/index.html">SpaceX</a>
                                                                                        </h6>
                                                                                        <div class="video-cat">
                                                                                            <a href="../documentary/index.html"
                                                                                                rel="tag">Documentary</a>
                                                                                            <a href="../sci-fi/index.html"
                                                                                                rel="tag">Sci-Fi</a>
                                                                                        </div>


                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                class="top-videos-item col-xl-12 col-lg-12 col-12">
                                                                                <div class="top-videos-inner">

                                                                                    <div class="top-number h5">

                                                                                        2
                                                                                    </div>
                                                                                    <div class="top-images">

                                                                                        <a
                                                                                            href="../../movie/the-sleeping-angel/index.html">
                                                                                            <img class='attachment-50x70 size-50x70'
                                                                                                alt=''
                                                                                                src="{{ asset('clients/wp-content/uploads/2023/02/movies2-50x70.jpg') }}">
                                                                                        </a>

                                                                                    </div>
                                                                                    <div class="top-content">
                                                                                        <div class="video-years">
                                                                                            2019</div>
                                                                                        <h6>
                                                                                            <a
                                                                                                href="../../movie/the-sleeping-angel/index.html">The
                                                                                                Sleeping Angel</a>
                                                                                        </h6>
                                                                                        <div class="video-cat">
                                                                                            <a href="../crime/index.html"
                                                                                                rel="tag">Crime</a>
                                                                                            <a href="../sci-fi/index.html"
                                                                                                rel="tag">Sci-Fi</a>
                                                                                        </div>


                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                class="top-videos-item col-xl-12 col-lg-12 col-12">
                                                                                <div class="top-videos-inner">

                                                                                    <div class="top-number h5">

                                                                                        3
                                                                                    </div>
                                                                                    <div class="top-images">

                                                                                        <a
                                                                                            href="../../movie/night-of-the-living-dead/index.html">
                                                                                            <img class='attachment-50x70 size-50x70'
                                                                                                alt=''
                                                                                                src="{{ asset('clients/wp-content/uploads/2023/02/image_deads-50x70.jpg') }}">
                                                                                        </a>

                                                                                    </div>
                                                                                    <div class="top-content">
                                                                                        <div class="video-years">
                                                                                            2018</div>
                                                                                        <h6>
                                                                                            <a
                                                                                                href="../../movie/night-of-the-living-dead/index.html">Night
                                                                                                of The Living
                                                                                                Dead</a>
                                                                                        </h6>
                                                                                        <div class="video-cat">
                                                                                            <a href="../history/index.html"
                                                                                                rel="tag">History</a>
                                                                                            <a href="../horror/index.html"
                                                                                                rel="tag">Horror</a>
                                                                                        </div>


                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                class="top-videos-item col-xl-12 col-lg-12 col-12">
                                                                                <div class="top-videos-inner">

                                                                                    <div class="top-number h5">

                                                                                        4
                                                                                    </div>
                                                                                    <div class="top-images">

                                                                                        <a
                                                                                            href="../../movie/the-white-house/index.html">
                                                                                            <img class='attachment-50x70 size-50x70'
                                                                                                alt=''
                                                                                                src="{{ asset('clients/wp-content/uploads/2023/06/6TeIVKPw7nXXWy2zKmDmlnSwzb7-scaled-50x70.jpg') }}">
                                                                                        </a>

                                                                                    </div>
                                                                                    <div class="top-content">
                                                                                        <div class="video-years">
                                                                                            2023</div>
                                                                                        <h6>
                                                                                            <a
                                                                                                href="../../movie/the-white-house/index.html">The
                                                                                                White House</a>
                                                                                        </h6>
                                                                                        <div class="video-cat">
                                                                                            <a href="index.html"
                                                                                                rel="tag">Action</a>
                                                                                            <a href="../adventure/index.html"
                                                                                                rel="tag">Adventure</a>
                                                                                        </div>


                                                                                    </div>

                                                                                </div>
                                                                            </div>
                                                                            <div
                                                                                class="top-videos-item col-xl-12 col-lg-12 col-12">
                                                                                <div class="top-videos-inner">

                                                                                    <div class="top-number h5">

                                                                                        5
                                                                                    </div>
                                                                                    <div class="top-images">

                                                                                        <a
                                                                                            href="../../movie/the-blood-moon-party/index.html">
                                                                                            <img class='attachment-50x70 size-50x70'
                                                                                                alt=''
                                                                                                src="{{ asset('clients/wp-content/uploads/2023/02/blood-50x70.jpg') }}"">
                                                                                        </a>

                                                                                    </div>
                                                                                    <div class="top-content">
                                                                                        <div class="video-years">
                                                                                            2020</div>
                                                                                        <h6>
                                                                                            <a
                                                                                                href="../../movie/the-blood-moon-party/index.html">The
                                                                                                Blood Moon Party</a>
                                                                                        </h6>
                                                                                        <div class="video-cat">
                                                                                            <a href="../adventure/index.html"
                                                                                                rel="tag">Adventure</a>
                                                                                            <a href="../sci-fi/index.html"
                                                                                                rel="tag">Sci-Fi</a>
                                                                                        </div>


                                                                                    </div>

                                                                                </div>
                                                                            </div>





                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>





                                                </div>
                                            </section>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                        <div class="post_content col-xl-10 col-lg-12 col-12">
                            <div class="archive-nav row row-end-height">
                                <div class="col-xl-6 col-lg-12">
                                    <a class="show_filter_shop" href="javascript:void(0)">
                                        <i aria-hidden="true" class="jws-icon-plus"></i>
                                        <span>Filters</span>
                                    </a>

                                    <div class="post-result fs-small cl-heading" id="post-result">
                                        {{-- initial count --}}
                                        @if ($movies->total() > 0)
                                            Showing {{ $movies->firstItem() }} to {{ $movies->lastItem() }} item of
                                            {{ $movies->total() }} results
                                        @else
                                            Showing 0 results
                                        @endif
                                    </div>
                                </div>

                                <div class="col-xl-6 col-lg-12">
                                    <form method="get" id="filter-form" action="{{ route('category.filter') }}"
                                        class="post-select-filter fs-small">
                                        <div class="fild-item">
                                            <select class='cat_change' name="category">
                                                <option value="">Danh mục</option>
                                                @foreach ($categories as $category)
                                                    <option value="{{ $category->id }}"
                                                        @if ($category->id == request()->category) selected @endif>
                                                        {{ $category->name }}</option>
                                                @endforeach
                                            </select>
                                        </div>

                                        <div class="fild-item">
                                            <select class="years" name="years">
                                                <option value="">Year</option>
                                                @for ($y = 2016; $y <= date('Y'); $y++)
                                                    <option value="{{ $y }}"
                                                        @if (request()->years == $y) selected @endif>
                                                        {{ $y }}</option>
                                                @endfor
                                            </select>
                                        </div>

                                        <div class="fild-item">
                                            <select class="sortby" name="sortby">
                                                <option value="">Sort by</option>
                                                <option value="title" @if (request()->sortby == 'title') selected @endif>
                                                    Title</option>
                                                <option value="date" @if (request()->sortby == 'date') selected @endif>
                                                    Date</option>
                                                <option value="likes" @if (request()->sortby == 'likes') selected @endif>
                                                    Likes</option>
                                                <option value="views" @if (request()->sortby == 'views') selected @endif>
                                                    Views</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="button-default">lọc</button>
                                    </form>
                                </div>
                            </div>

                            <div class="movies_advanced_content row layout3" id="movie-list">
                                @include('client_movie.partials.movie_list', ['movies' => $movies])
                            </div>

                            <div id="pagination-wrap">
                                @include('client_movie.partials.pagination', ['movies' => $movies])
                            </div>
                        </div>


                    </div>

                </div>
            </main><!-- #main -->
        </div><!-- #primary -->
    </div><!-- #content -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('filter-form');
            const movieList = document.getElementById('movie-list');
            const paginationWrap = document.getElementById('pagination-wrap');
            const postResult = document.getElementById('post-result');

            // Gọi khi form thay đổi (select change)
            form.addEventListener('change', function(e) {
                // khi select thay đổi — luôn về trang 1
                submitFilters();
            });

            // Bắt submit form (nếu có)
            form.addEventListener('submit', function(e) {

                e.preventDefault();
                submitFilters();
            });

            // Delegation: bắt click tất cả các link trong pagination-wrap
            document.addEventListener('click', function(e) {
                const a = e.target.closest('#pagination-wrap a');
                if (!a) return;
                e.preventDefault();
                // Lấy href từ link (link đã chứa query string vì withQueryString())
                const url = new URL(a.href, window.location.origin);
                // Đảm bảo giữ các filter hiện tại (nếu link không chứa)
                submitFilters(url.searchParams);
            });

            function submitFilters(optionalParams) {
                // Lấy form data
                const formData = new FormData(form);

                // Nếu optionalParams là instance of URLSearchParams, dùng nó (khi click pagination),
                // nếu không, convert formData -> URLSearchParams (mặc định)
                let params;
                if (optionalParams && typeof optionalParams.forEach === 'function') {
                    // optionalParams là URLSearchParams
                    // Nhưng ta vẫn muốn đảm bảo các filter hiện tại từ form override page param
                    params = new URLSearchParams();
                    // copy form fields first
                    for (const pair of formData.entries()) {
                        if (pair[1] !== null && pair[1] !== '') params.append(pair[0], pair[1]);
                    }
                    // merge pagination params from optionalParams (page=...)
                    optionalParams.forEach((value, key) => {
                        // nếu là page thì set page, còn field khác để optional override? ta ưu tiên optional page
                        params.set(key, value);
                    });
                } else {
                    params = new URLSearchParams(formData);
                }

                // luôn reset to page 1 nếu không phải click pagination
                if (!optionalParams) params.delete('page');

                // build url
                const url = '{{ route('category.filter') }}' + '?' + params.toString();

                // fetch GET
                fetch(url, {
                        method: 'GET',
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest',
                            'Accept': 'application/json'
                        }
                    })
                    .then(response => {
                        if (!response.ok) throw new Error('Network error');
                        return response.json();
                    })
                    .then(data => {
                        // data: { html: '...', pagination: '...', countText: '...' }
                        if (data.html !== undefined) {
                            movieList.innerHTML = data.html;
                        } else {
                            movieList.innerHTML = '<p>No results</p>';
                        }

                        if (data.pagination !== undefined) {
                            paginationWrap.innerHTML = data.pagination;
                        } else {
                            paginationWrap.innerHTML = '';
                        }

                        if (data.countText !== undefined) {
                            postResult.textContent = data.countText;
                        }

                        // Update browser URL (so user có thể copy link): history.pushState
                        // Gắn URL hiện tại bằng params (không reload)
                        const newUrl = '{{ url()->current() }}' + '?' + params.toString();
                        window.history.replaceState({}, '', newUrl);
                    })
                    .catch(err => {
                        console.error('Error fetching movies:', err);
                        // Có thể show toast / message
                    });
            }

            // OPTIONAL: khi user bấm back/forward, load lại state từ URL
            window.addEventListener('popstate', function(event) {
                // khởi tạo params từ window.location
                const params = new URLSearchParams(window.location.search);
                // copy params vào form fields
                for (const [k, v] of params.entries()) {
                    const field = form.elements[k];
                    if (field) {
                        field.value = v;
                    }
                }
                // submit with params (keeps page if present)
                submitFilters(params);
            });

        });
    </script>


    {{-- <script>
        document.addEventListener('DOMContentLoaded', function() {
            const selects = document.querySelectorAll('.post-select-filter select');
            selects.forEach(select => {
                select.addEventListener('change', function() {
                    this.form.submit();
                });
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const loadMoreButton = document.getElementById('load-more');
            const movieList = document.getElementById('movie-list');

            function fetchMovies(page) {
                const form = document.getElementById('filter-form');
                const formData = new FormData(form);
                formData.append('page', page);

                const params = new URLSearchParams(formData).toString();

                fetch(`/fetch-movies?${params}`)
                    .then(response => {
                        if (!response.ok) throw new Error('Failed to fetch movies');
                        return response.json();
                    })
                    .then(data => {
                        data.movies.forEach(movie => {
                            const movieCard = `
                    <div class="col-6 col-sm-4 col-lg-3 col-xl-2">
                        <div class="card">
                            <a href="/movie/show/${movie.slug}" class="card__cover">
                                <img src="${ '/storage/images/' + movie.poster_url}" alt="${movie.title}">
                            </a>
                            <span class="card__rating">${movie.rating}</span>
                            <h3 class="card__title">
                                <a href="/movie/show/${movie.slug}">${movie.title}</a>
                            </h3>
                        </div>
                    </div>
                `;
                            movieList.insertAdjacentHTML('beforeend', movieCard);
                        });

                        if (data.nextPage) {
                            loadMoreButton.setAttribute('data-page', data.nextPage);
                        } else {
                            loadMoreButton.style.display = 'none';
                        }
                    })
                    .catch(error => console.error('Error fetching movies:', error));
            }

            // Bắt sự kiện nhấn nút "Load more"
            loadMoreButton.addEventListener('click', () => {
                const nextPage = loadMoreButton.getAttribute('data-page');
                fetchMovies(nextPage);
            });
        });
    </script>
    <script>
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            const formData = new FormData(form);
            const params = new URLSearchParams(formData).toString();

            fetch(form.action + '?' + params, {
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newMovieList = doc.querySelector('#movie-list');
                    movieList.innerHTML = newMovieList.innerHTML;

                    // Reset lại nút load more
                    loadMoreButton.setAttribute('data-page', 2); // Trang tiếp theo sau khi lọc
                    loadMoreButton.style.display = 'inline-block';
                });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('filter-form');
            const movieList = document.getElementById('movie-list');

            form.addEventListener('submit', function(e) {
                e.preventDefault(); // chặn form submit mặc định

                const formData = new FormData(form);
                const params = new URLSearchParams(formData).toString();

                fetch(form.action + '?' + params, {
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'
                        }
                    })
                    .then(response => {
                        if (!response.ok) throw new Error("Network error");
                        return response.text();
                    })
                    .then(html => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(html, 'text/html');
                        const newMovieList = doc.querySelector('#movie-list');
                        movieList.innerHTML = newMovieList.innerHTML;
                    })
                    .catch(err => {
                        console.error('Fetch error:', err);
                    });
            });
        });
    </script> --}}
    <!-- end subscriptions -->
@endsection
