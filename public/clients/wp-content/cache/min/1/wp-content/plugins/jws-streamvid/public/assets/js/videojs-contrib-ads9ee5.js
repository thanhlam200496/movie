/*! @name videojs-contrib-ads @version 6.9.0 @license Apache-2.0 */
(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory(require('video.js'),require('global/window'),require('global/document')):typeof define==='function'&&define.amd?define(['video.js','global/window','global/document'],factory):(global=global||self,global.videojsContribAds=factory(global.videojs,global.window,global.document))}(this,function(videojs,window,document){'use strict';videojs=videojs&&videojs.hasOwnProperty('default')?videojs['default']:videojs;window=window&&window.hasOwnProperty('default')?window['default']:window;document=document&&document.hasOwnProperty('default')?document['default']:document;var version="6.9.0";function getAds(player){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:version,reset:function reset(){player.ads.disableNextSnapshotRestore=!1;player.ads._contentEnding=!1;player.ads._contentHasEnded=!1;player.ads.snapshot=null;player.ads.adType=null;player.ads._hasThereBeenALoadedData=!1;player.ads._hasThereBeenALoadedMetaData=!1;player.ads._cancelledPlay=!1;player.ads._shouldBlockPlay=!1;player.ads._playBlocked=!1;player.ads.nopreroll_=!1;player.ads.nopostroll_=!1;player.ads._playRequested=!1},startLinearAdMode:function startLinearAdMode(){player.ads._state.startLinearAdMode()},endLinearAdMode:function endLinearAdMode(){player.ads._state.endLinearAdMode()},skipLinearAdMode:function skipLinearAdMode(){player.ads._state.skipLinearAdMode()},stitchedAds:function stitchedAds(arg){if(arg!==undefined){videojs.log.warn('Using player.ads.stitchedAds() as a setter is deprecated, '+'it should be set as an option upon initialization of contrib-ads.');this.settings.stitchedAds=!!arg}
return this.settings.stitchedAds},videoElementRecycled:function videoElementRecycled(){if(player.ads.shouldPlayContentBehindAd(player)){return!1}
if(!this.snapshot){throw new Error('You cannot use videoElementRecycled while there is no snapshot.')}
var srcChanged=player.tech_.src()!==this.snapshot.src;var currentSrcChanged=player.currentSrc()!==this.snapshot.currentSrc;return srcChanged||currentSrcChanged},isLive:function isLive(somePlayer){if(somePlayer===void 0){somePlayer=player}
if(typeof somePlayer.ads.settings.contentIsLive==='boolean'){return somePlayer.ads.settings.contentIsLive}else if(somePlayer.duration()===Infinity){return!0}else if(videojs.browser.IOS_VERSION==='8'&&somePlayer.duration()===0){return!0}
return!1},shouldPlayContentBehindAd:function shouldPlayContentBehindAd(somePlayer){if(somePlayer===void 0){somePlayer=player}
if(!somePlayer){throw new Error('shouldPlayContentBehindAd requires a player as a param')}else if(!somePlayer.ads.settings.liveCuePoints){return!1}else{return!videojs.browser.IS_IOS&&!videojs.browser.IS_ANDROID&&somePlayer.duration()===Infinity}},shouldTakeSnapshots:function shouldTakeSnapshots(somePlayer){if(somePlayer===void 0){somePlayer=player}
return!this.shouldPlayContentBehindAd(somePlayer)&&!this.stitchedAds()},isInAdMode:function isInAdMode(){return this._state.isAdState()},isWaitingForAdBreak:function isWaitingForAdBreak(){return this._state.isWaitingForAdBreak()},isContentResuming:function isContentResuming(){return this._state.isContentResuming()},isAdPlaying:function isAdPlaying(){return this._state.inAdBreak()},inAdBreak:function inAdBreak(){return this._state.inAdBreak()},removeNativePoster:function removeNativePoster(){var tech=player.$('.vjs-tech');if(tech){tech.removeAttribute('poster')}},debug:function debug(){if(this.settings.debug){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}
if(args.length===1&&typeof args[0]==='string'){videojs.log('ADS: '+args[0])}else{videojs.log.apply(videojs,['ADS:'].concat(args))}}}}}
var cancelEvent=function cancelEvent(player,event){event.isImmediatePropagationStopped=function(){return!0};event.cancelBubble=!0;event.isPropagationStopped=function(){return!0}};var prefixEvent=function prefixEvent(player,prefix,event){cancelEvent(player,event);player.trigger({type:prefix+event.type,originalEvent:event})};var handlePlaying=function handlePlaying(player,event){if(player.ads.isInAdMode()){if(player.ads.isContentResuming()){if(player.ads._contentEnding){prefixEvent(player,'content',event)}}else{prefixEvent(player,'ad',event)}}};var handleEnded=function handleEnded(player,event){if(player.ads.isInAdMode()){if(player.ads.isContentResuming()){cancelEvent(player,event);player.trigger('resumeended')}else{prefixEvent(player,'ad',event)}}else if(!player.ads._contentHasEnded&&!player.ads.stitchedAds()){prefixEvent(player,'content',event);player.trigger('readyforpostroll')}};var handleLoadEvent=function handleLoadEvent(player,event){if(event.type==='loadstart'&&!player.ads._hasThereBeenALoadStartDuringPlayerLife||event.type==='loadeddata'&&!player.ads._hasThereBeenALoadedData||event.type==='loadedmetadata'&&!player.ads._hasThereBeenALoadedMetaData){return}else if(player.ads.inAdBreak()){prefixEvent(player,'ad',event)}else if(player.currentSrc()!==player.ads.contentSrc){return}else{prefixEvent(player,'content',event)}};var handlePlay=function handlePlay(player,event){if(player.ads.inAdBreak()){prefixEvent(player,'ad',event)}else if(player.ads.isContentResuming()){prefixEvent(player,'content',event)}};function redispatch(event){if(event.type==='playing'){handlePlaying(this,event)}else if(event.type==='ended'){handleEnded(this,event)}else if(event.type==='loadstart'||event.type==='loadeddata'||event.type==='loadedmetadata'){handleLoadEvent(this,event)}else if(event.type==='play'){handlePlay(this,event)}else if(this.ads.isInAdMode()){if(this.ads.isContentResuming()){prefixEvent(this,'content',event)}else{prefixEvent(this,'ad',event)}}}
function initializeContentupdate(player){player.ads.contentSrc=player.currentSrc();player.ads._seenInitialLoadstart=!1;var checkSrc=function checkSrc(){if(!player.ads.inAdBreak()){var src=player.currentSrc();if(src!==player.ads.contentSrc){if(player.ads._seenInitialLoadstart){player.trigger({type:'contentchanged'})}
player.trigger({type:'contentupdate',oldValue:player.ads.contentSrc,newValue:src});player.ads.contentSrc=src}
player.ads._seenInitialLoadstart=!0}};player.on('loadstart',checkSrc)}
var tcData={};var proxyTcfApi=function proxyTcfApi(_){if(videojs.dom.isInFrame()&&typeof window.__tcfapi!=='function'){var frame=window;var cmpFrame;var cmpCallbacks={};while(frame){try{if(frame.frames.__tcfapiLocator){cmpFrame=frame;break}}catch(ignore){}
if(frame===window.top){break}
frame=frame.parent}
if(!cmpFrame){return}
window.__tcfapi=function(cmd,version,callback,arg){var callId=Math.random()+'';var msg={__tcfapiCall:{command:cmd,parameter:arg,version:version,callId:callId}};cmpCallbacks[callId]=callback;cmpFrame.postMessage(msg,'*')};window.addEventListener('message',function(event){var json={};try{json=typeof event.data==='string'?JSON.parse(event.data):event.data}catch(ignore){}
var payload=json.__tcfapiReturn;if(payload){if(typeof cmpCallbacks[payload.callId]==='function'){cmpCallbacks[payload.callId](payload.returnValue,payload.success);cmpCallbacks[payload.callId]=null}}},!1)}};var listenToTcf=function listenToTcf(){proxyTcfApi();if(typeof window.__tcfapi==='function'){window.__tcfapi('addEventListener',2,function(data,success){if(success){tcData=data}})}};var uriEncodeIfNeeded=function uriEncodeIfNeeded(value,uriEncode){if(uriEncode){return encodeURIComponent(value)}
return value};var customFields=function customFields(mediainfo,macros,customFieldsName){if(mediainfo&&mediainfo[customFieldsName]){var fields=mediainfo[customFieldsName];var fieldNames=Object.keys(fields);for(var i=0;i<fieldNames.length;i++){var tag='{mediainfo.'+customFieldsName+'.'+fieldNames[i]+'}';macros[tag]=fields[fieldNames[i]]}}};function adMacroReplacement(string,uriEncode,customMacros){var _this=this;var defaults={};string=string.replace(/{([^}=]+)=([^}]+)}/g,function(match,name,defaultVal){defaults["{"+name+"}"]=defaultVal;return"{"+name+"}"});if(uriEncode===undefined){uriEncode=!1}
var macros={};if(customMacros!==undefined){macros=customMacros}
macros['{player.id}']=this.options_['data-player']||this.id_;macros['{player.height}']=this.currentHeight();macros['{player.width}']=this.currentWidth();macros['{mediainfo.id}']=this.mediainfo?this.mediainfo.id:'';macros['{mediainfo.name}']=this.mediainfo?this.mediainfo.name:'';macros['{mediainfo.duration}']=this.mediainfo?this.mediainfo.duration:'';macros['{player.duration}']=this.duration();macros['{player.pageUrl}']=videojs.dom.isInFrame()?document.referrer:window.location.href;macros['{playlistinfo.id}']=this.playlistinfo?this.playlistinfo.id:'';macros['{playlistinfo.name}']=this.playlistinfo?this.playlistinfo.name:'';macros['{timestamp}']=new Date().getTime();macros['{document.referrer}']=document.referrer;macros['{window.location.href}']=window.location.href;macros['{random}']=Math.floor(Math.random()*1000000000000);['description','tags','reference_id','ad_keys'].forEach(function(prop){if(_this.mediainfo&&_this.mediainfo[prop]){macros["{mediainfo."+prop+"}"]=_this.mediainfo[prop]}else if(defaults["{mediainfo."+prop+"}"]){macros["{mediainfo."+prop+"}"]=defaults["{mediainfo."+prop+"}"]}else{macros["{mediainfo."+prop+"}"]=''}});customFields(this.mediainfo,macros,'custom_fields');customFields(this.mediainfo,macros,'customFields');Object.keys(tcData).forEach(function(key){macros["{tcf."+key+"}"]=tcData[key]});macros['{tcf.gdprAppliesInt}']=tcData.gdprApplies?1:0;for(var i in macros){string=string.split(i).join(uriEncodeIfNeeded(macros[i],uriEncode))}
string=string.replace(/{pageVariable\.([^}]+)}/g,function(match,name){var value;var context=window;var names=name.split('.');for(var _i=0;_i<names.length;_i++){if(_i===names.length-1){value=context[names[_i]]}else{context=context[names[_i]]}}
var type=typeof value;if(value===null){return'null'}else if(value===undefined){if(defaults["{pageVariable."+name+"}"]){return defaults["{pageVariable."+name+"}"]}
videojs.log.warn("Page variable \""+name+"\" not found");return''}else if(type!=='string'&&type!=='number'&&type!=='boolean'){videojs.log.warn("Page variable \""+name+"\" is not a supported type");return''}
return uriEncodeIfNeeded(String(value),uriEncode)});for(var defaultVal in defaults){string=string.replace(defaultVal,defaults[defaultVal])}
return string}
var cueTextTracks={};cueTextTracks.processMetadataTracks=function(player,processMetadataTrack){var tracks=player.textTracks();var setModeAndProcess=function setModeAndProcess(track){if(track.kind==='metadata'){player.ads.cueTextTracks.setMetadataTrackMode(track);processMetadataTrack(player,track)}};for(var i=0;i<tracks.length;i++){setModeAndProcess(tracks[i])}
tracks.addEventListener('addtrack',function(event){setModeAndProcess(event.track)})};cueTextTracks.setMetadataTrackMode=function(track){return};cueTextTracks.getSupportedAdCue=function(player,cue){return cue};cueTextTracks.isSupportedAdCue=function(player,cue){return!0};cueTextTracks.getCueId=function(player,cue){return cue.id};var cueAlreadySeen=function cueAlreadySeen(player,cueId){return cueId!==undefined&&player.ads.includedCues[cueId]};var setCueAlreadySeen=function setCueAlreadySeen(player,cueId){if(cueId!==undefined&&cueId!==''){player.ads.includedCues[cueId]=!0}};cueTextTracks.processAdTrack=function(player,cues,processCue,cancelAdsHandler){player.ads.includedCues={};for(var i=0;i<cues.length;i++){var cue=cues[i];var cueData=this.getSupportedAdCue(player,cue);if(!this.isSupportedAdCue(player,cue)){videojs.log.warn('Skipping as this is not a supported ad cue.',cue);return}
var cueId=this.getCueId(player,cue);var startTime=cue.startTime;if(cueAlreadySeen(player,cueId)){videojs.log('Skipping ad already seen with ID '+cueId);return}
if(cancelAdsHandler){cancelAdsHandler(player,cueData,cueId,startTime)}
processCue(player,cueData,cueId,startTime);setCueAlreadySeen(player,cueId)}};function initCancelContentPlay(player,debug){if(debug){videojs.log('Using cancelContentPlay to block content playback')}
player.on('play',cancelContentPlay)}
function cancelContentPlay(){if(this.ads._shouldBlockPlay===!1){return}
if(!this.paused()){this.ads.debug('Playback was canceled by cancelContentPlay');this.pause()}
this.ads._cancelledPlay=!0}
var obj={};var videojsReference=videojs;obj.isMiddlewareMediatorSupported=function(){if(videojsReference.browser.IS_IOS||videojsReference.browser.IS_ANDROID){return!1}else if(videojsReference.use&&videojsReference.middleware&&videojsReference.middleware.TERMINATOR){return!0}
return!1};obj.playMiddleware=function(player){return{setSource:function setSource(srcObj,next){next(null,srcObj)},callPlay:function callPlay(){if(player.ads&&player.ads._shouldBlockPlay===!0){player.ads.debug('Using playMiddleware to block content playback');player.ads._playBlocked=!0;return videojsReference.middleware.TERMINATOR}},play:function play(terminated,playPromise){if(player.ads&&player.ads._playBlocked&&terminated){player.ads.debug('Play call to Tech was terminated.');player.trigger('play');player.addClass('vjs-has-started');player.ads._playBlocked=!1}else if(playPromise&&playPromise.catch){playPromise.catch(function(e){if(e.name==='NotAllowedError'&&!videojs.browser.IS_SAFARI){player.trigger('pause')}})}}}};obj.testHook=function(testVjs){videojsReference=testVjs};var playMiddleware=obj.playMiddleware,isMiddlewareMediatorSupported=obj.isMiddlewareMediatorSupported;var hasAdsPlugin=function hasAdsPlugin(){if(videojs.getPlugin){return Boolean(videojs.getPlugin('ads'))}
var Player=videojs.getComponent('Player');return Boolean(Player&&Player.prototype.ads)};function register(contribAdsPlugin){if(hasAdsPlugin(videojs)){return!1}
var registerPlugin=videojs.registerPlugin||videojs.plugin;registerPlugin('ads',contribAdsPlugin);if(isMiddlewareMediatorSupported()&&!videojs.usingContribAdsMiddleware_){videojs.use('*',playMiddleware);videojs.usingContribAdsMiddleware_=!0;videojs.log.debug('Play middleware has been registered with videojs')}
return!0}
var States=function(){function States(){}
States.getState=function getState(name){if(!name){return}
if(States.states_&&States.states_[name]){return States.states_[name]}};States.registerState=function registerState(name,StateToRegister){if(typeof name!=='string'||!name){throw new Error("Illegal state name, \""+name+"\"; must be a non-empty string.")}
if(!States.states_){States.states_={}}
States.states_[name]=StateToRegister;return StateToRegister};return States}();var State=function(){State._getName=function _getName(){return'Anonymous State'};function State(player){this.player=player}
var _proto=State.prototype;_proto.transitionTo=function transitionTo(NewState){var player=this.player;this.cleanup(player);var newState=new NewState(player);player.ads._state=newState;player.ads.debug(this.constructor._getName()+' -> '+newState.constructor._getName());for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}
newState.init.apply(newState,[player].concat(args))};_proto.init=function init(){};_proto.cleanup=function cleanup(){};_proto.onPlay=function onPlay(){};_proto.onPlaying=function onPlaying(){};_proto.onEnded=function onEnded(){};_proto.onAdEnded=function onAdEnded(){};_proto.onAdsReady=function onAdsReady(){videojs.log.warn('Unexpected adsready event')};_proto.onAdsError=function onAdsError(){};_proto.onAdsCanceled=function onAdsCanceled(){};_proto.onAdTimeout=function onAdTimeout(){};_proto.onAdStarted=function onAdStarted(){};_proto.onContentChanged=function onContentChanged(){};_proto.onContentResumed=function onContentResumed(){};_proto.onReadyForPostroll=function onReadyForPostroll(){videojs.log.warn('Unexpected readyforpostroll event')};_proto.onNoPreroll=function onNoPreroll(){};_proto.onNoPostroll=function onNoPostroll(){};_proto.startLinearAdMode=function startLinearAdMode(){videojs.log.warn('Unexpected startLinearAdMode invocation '+'(State via '+this.constructor._getName()+')')};_proto.endLinearAdMode=function endLinearAdMode(){videojs.log.warn('Unexpected endLinearAdMode invocation '+'(State via '+this.constructor._getName()+')')};_proto.skipLinearAdMode=function skipLinearAdMode(){videojs.log.warn('Unexpected skipLinearAdMode invocation '+'(State via '+this.constructor._getName()+')')};_proto.isAdState=function isAdState(){throw new Error('isAdState unimplemented for '+this.constructor._getName())};_proto.isWaitingForAdBreak=function isWaitingForAdBreak(){return!1};_proto.isContentResuming=function isContentResuming(){return!1};_proto.inAdBreak=function inAdBreak(){return!1};_proto.handleEvent=function handleEvent(type){var player=this.player;if(type==='play'){this.onPlay(player)}else if(type==='adsready'){this.onAdsReady(player)}else if(type==='adserror'){this.onAdsError(player)}else if(type==='adscanceled'){this.onAdsCanceled(player)}else if(type==='adtimeout'){this.onAdTimeout(player)}else if(type==='ads-ad-started'){this.onAdStarted(player)}else if(type==='contentchanged'){this.onContentChanged(player)}else if(type==='contentresumed'){this.onContentResumed(player)}else if(type==='readyforpostroll'){this.onReadyForPostroll(player)}else if(type==='playing'){this.onPlaying(player)}else if(type==='ended'){this.onEnded(player)}else if(type==='nopreroll'){this.onNoPreroll(player)}else if(type==='nopostroll'){this.onNoPostroll(player)}else if(type==='adended'){this.onAdEnded(player)}};return State}();States.registerState('State',State);function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype);subClass.prototype.constructor=subClass;subClass.__proto__=superClass}
var AdState=function(_State){_inheritsLoose(AdState,_State);function AdState(player){var _this;_this=_State.call(this,player)||this;_this.contentResuming=!1;_this.waitingForAdBreak=!1;return _this}
var _proto=AdState.prototype;_proto.isAdState=function isAdState(){return!0};_proto.onPlaying=function onPlaying(){var ContentPlayback=States.getState('ContentPlayback');if(this.contentResuming){this.transitionTo(ContentPlayback)}};_proto.onContentResumed=function onContentResumed(){var ContentPlayback=States.getState('ContentPlayback');if(this.contentResuming){this.transitionTo(ContentPlayback)}};_proto.isWaitingForAdBreak=function isWaitingForAdBreak(){return this.waitingForAdBreak};_proto.isContentResuming=function isContentResuming(){return this.contentResuming};_proto.inAdBreak=function inAdBreak(){return this.player.ads._inLinearAdMode===!0};return AdState}(State);States.registerState('AdState',AdState);var ContentState=function(_State){_inheritsLoose(ContentState,_State);function ContentState(){return _State.apply(this,arguments)||this}
var _proto=ContentState.prototype;_proto.isAdState=function isAdState(){return!1};_proto.onContentChanged=function onContentChanged(player){var BeforePreroll=States.getState('BeforePreroll');var Preroll=States.getState('Preroll');player.ads.debug('Received contentchanged event (ContentState)');if(player.paused()){this.transitionTo(BeforePreroll)}else{this.transitionTo(Preroll,!1);player.pause();player.ads._pausedOnContentupdate=!0}};return ContentState}(State);States.registerState('ContentState',ContentState);var ContentState$1=States.getState('ContentState');var AdsDone=function(_ContentState){_inheritsLoose(AdsDone,_ContentState);function AdsDone(){return _ContentState.apply(this,arguments)||this}
AdsDone._getName=function _getName(){return'AdsDone'};var _proto=AdsDone.prototype;_proto.init=function init(player){player.ads._contentHasEnded=!0;player.trigger('ended')};_proto.startLinearAdMode=function startLinearAdMode(){videojs.log.warn('Unexpected startLinearAdMode invocation (AdsDone)')};return AdsDone}(ContentState$1);States.registerState('AdsDone',AdsDone);var tryToResumeTimeout_;function getPlayerSnapshot(player){var currentTime;if(videojs.browser.IS_IOS&&player.ads.isLive(player)){if(player.seekable().length>0){currentTime=player.currentTime()-player.seekable().end(0)}else{currentTime=player.currentTime()}}else{currentTime=player.currentTime()}
var tech=player.$('.vjs-tech');var tracks=player.textTracks?player.textTracks():[];var suppressedTracks=[];var snapshotObject={ended:player.ended(),currentSrc:player.currentSrc(),sources:player.currentSources(),src:player.tech_.src(),currentTime:currentTime,type:player.currentType()};if(tech){snapshotObject.style=tech.getAttribute('style')}
for(var i=0;i<tracks.length;i++){var track=tracks[i];suppressedTracks.push({track:track,mode:track.mode});track.mode='disabled'}
snapshotObject.suppressedTracks=suppressedTracks;return snapshotObject}
function restorePlayerSnapshot(player,callback){var snapshotObject=player.ads.snapshot;if(callback===undefined){callback=function callback(){}}
if(player.ads.disableNextSnapshotRestore===!0){player.ads.disableNextSnapshotRestore=!1;delete player.ads.snapshot;callback();return}
var tech=player.$('.vjs-tech');var attempts=20;var suppressedTracks=snapshotObject.suppressedTracks;var trackSnapshot;var restoreTracks=function restoreTracks(){for(var i=0;i<suppressedTracks.length;i++){trackSnapshot=suppressedTracks[i];trackSnapshot.track.mode=trackSnapshot.mode}};var resume=function resume(){var currentTime;if(videojs.browser.IS_IOS&&player.ads.isLive(player)){if(snapshotObject.currentTime<0){if(player.seekable().length>0){currentTime=player.seekable().end(0)+snapshotObject.currentTime}else{currentTime=player.currentTime()}
player.currentTime(currentTime)}
if(player.paused()){var playPromise=player.play();if(playPromise&&playPromise.catch){playPromise.catch(function(error){videojs.log.warn('Play promise rejected in IOS snapshot resume',error)})}}}else if(snapshotObject.ended){player.currentTime(player.duration())}else{player.currentTime(snapshotObject.currentTime);var _playPromise=player.play();if(_playPromise&&_playPromise.catch){_playPromise.catch(function(error){videojs.log.warn('Play promise rejected in snapshot resume',error)})}}
if(player.ads.shouldRemoveAutoplay_){player.autoplay(!1);player.ads.shouldRemoveAutoplay_=!1}};var tryToResume=function tryToResume(){player.off('contentcanplay',tryToResume);if(tryToResumeTimeout_){player.clearTimeout(tryToResumeTimeout_)}
tech=player.el().querySelector('.vjs-tech');if(tech.readyState>1){return resume()}
if(tech.seekable===undefined){return resume()}
if(tech.seekable.length>0){return resume()}
if(attempts--){player.setTimeout(tryToResume,50)}else{try{resume()}catch(e){videojs.log.warn('Failed to resume the content after an advertisement',e)}}};if('style' in snapshotObject){tech.setAttribute('style',snapshotObject.style||'')}
if(player.ads.videoElementRecycled()){player.one('resumeended',function(){delete player.ads.snapshot;callback()});player.one('contentloadedmetadata',restoreTracks);if(videojs.browser.IS_IOS&&!player.autoplay()){player.autoplay(!0);player.ads.shouldRemoveAutoplay_=!0}
player.src(snapshotObject.sources);player.one('contentcanplay',tryToResume);tryToResumeTimeout_=player.setTimeout(tryToResume,2000)}else{restoreTracks();if(!player.ended()){var playPromise=player.play();if(playPromise&&playPromise.catch){playPromise.catch(function(error){videojs.log.warn('Play promise rejected in snapshot restore',error)})}}
delete player.ads.snapshot;callback()}}
function start(player){player.ads.debug('Starting ad break');player.ads._inLinearAdMode=!0;player.trigger('adstart');if(player.ads.shouldTakeSnapshots()){player.ads.snapshot=getPlayerSnapshot(player)}
if(player.ads.shouldPlayContentBehindAd(player)){player.ads.preAdVolume_=player.volume();player.volume(0)}
player.addClass('vjs-ad-playing');if(player.hasClass('vjs-live')){player.removeClass('vjs-live')}
player.ads.removeNativePoster()}
function end(player,callback){player.ads.debug('Ending ad break');if(callback===undefined){callback=function callback(){}}
player.ads.adType=null;player.ads._inLinearAdMode=!1;player.trigger('adend');player.removeClass('vjs-ad-playing');if(player.ads.isLive(player)){player.addClass('vjs-live');player.play()}
if(player.ads.shouldTakeSnapshots()){restorePlayerSnapshot(player,callback)}else{player.volume(player.ads.preAdVolume_);callback()}}
var obj$1={start:start,end:end};var AdState$1=States.getState('AdState');var Preroll=function(_AdState){_inheritsLoose(Preroll,_AdState);function Preroll(){return _AdState.apply(this,arguments)||this}
Preroll._getName=function _getName(){return'Preroll'};var _proto=Preroll.prototype;_proto.init=function init(player,adsReady,shouldResumeToContent){this.waitingForAdBreak=!0;player.addClass('vjs-ad-loading');if(shouldResumeToContent||player.ads.nopreroll_){return this.resumeAfterNoPreroll(player)}
var timeout=player.ads.settings.timeout;if(typeof player.ads.settings.prerollTimeout==='number'){timeout=player.ads.settings.prerollTimeout}
this._timeout=player.setTimeout(function(){player.trigger('adtimeout')},timeout);if(adsReady){this.handleAdsReady()}else{this.adsReady=!1}};_proto.onAdsReady=function onAdsReady(player){if(!player.ads.inAdBreak()){player.ads.debug('Received adsready event (Preroll)');this.handleAdsReady()}else{videojs.log.warn('Unexpected adsready event (Preroll)')}};_proto.handleAdsReady=function handleAdsReady(){this.adsReady=!0;this.readyForPreroll()};_proto.afterLoadStart=function afterLoadStart(callback){var player=this.player;if(player.ads._hasThereBeenALoadStartDuringPlayerLife){callback()}else{player.ads.debug('Waiting for loadstart...');player.one('loadstart',function(){player.ads.debug('Received loadstart event');callback()})}};_proto.noPreroll=function noPreroll(){var _this=this;this.afterLoadStart(function(){_this.player.ads.debug('Skipping prerolls due to nopreroll event (Preroll)');_this.resumeAfterNoPreroll(_this.player)})};_proto.readyForPreroll=function readyForPreroll(){var player=this.player;this.afterLoadStart(function(){player.ads.debug('Triggered readyforpreroll event (Preroll)');player.trigger('readyforpreroll')})};_proto.onAdsCanceled=function onAdsCanceled(player){var _this2=this;player.ads.debug('adscanceled (Preroll)');this.afterLoadStart(function(){_this2.resumeAfterNoPreroll(player)})};_proto.onAdsError=function onAdsError(player){var _this3=this;videojs.log('adserror (Preroll)');if(this.inAdBreak()){player.ads.endLinearAdMode()}else{this.afterLoadStart(function(){_this3.resumeAfterNoPreroll(player)})}};_proto.startLinearAdMode=function startLinearAdMode(){var player=this.player;this.clearTimeout(player);player.ads.adType='preroll';this.waitingForAdBreak=!1;obj$1.start(player);player.ads._shouldBlockPlay=!1};_proto.onAdStarted=function onAdStarted(player){player.removeClass('vjs-ad-loading')};_proto.endLinearAdMode=function endLinearAdMode(){var player=this.player;if(this.inAdBreak()){player.removeClass('vjs-ad-loading');player.addClass('vjs-ad-content-resuming');this.contentResuming=!0;obj$1.end(player)}};_proto.skipLinearAdMode=function skipLinearAdMode(){var _this4=this;var player=this.player;if(player.ads.inAdBreak()||this.isContentResuming()){videojs.log.warn('Unexpected skipLinearAdMode invocation')}else{this.afterLoadStart(function(){player.trigger('adskip');player.ads.debug('skipLinearAdMode (Preroll)');_this4.resumeAfterNoPreroll(player)})}};_proto.onAdTimeout=function onAdTimeout(player){var _this5=this;this.afterLoadStart(function(){player.ads.debug('adtimeout (Preroll)');_this5.resumeAfterNoPreroll(player)})};_proto.onNoPreroll=function onNoPreroll(player){if(player.ads.inAdBreak()||this.isContentResuming()){videojs.log.warn('Unexpected nopreroll event (Preroll)')}else{this.noPreroll()}};_proto.resumeAfterNoPreroll=function resumeAfterNoPreroll(player){this.contentResuming=!0;player.ads._shouldBlockPlay=!1;this.cleanupPartial(player);if(player.ads._playRequested||player.ads._pausedOnContentupdate){if(player.paused()){player.ads.debug('resumeAfterNoPreroll: attempting to resume playback (Preroll)');var playPromise=player.play();if(playPromise&&playPromise.then){playPromise.then(null,function(e){})}}else{player.ads.debug('resumeAfterNoPreroll: already playing (Preroll)');player.trigger('play');player.trigger('playing')}}};_proto.cleanup=function cleanup(player){if(!player.ads._hasThereBeenALoadStartDuringPlayerLife){videojs.log.warn('Leaving Preroll state before loadstart event can cause issues.')}
this.cleanupPartial(player)};_proto.cleanupPartial=function cleanupPartial(player){player.removeClass('vjs-ad-loading');player.removeClass('vjs-ad-content-resuming');this.clearTimeout(player)};_proto.clearTimeout=function clearTimeout(player){player.clearTimeout(this._timeout);this._timeout=null};return Preroll}(AdState$1);States.registerState('Preroll',Preroll);var ContentState$2=States.getState('ContentState');var BeforePreroll=function(_ContentState){_inheritsLoose(BeforePreroll,_ContentState);function BeforePreroll(){return _ContentState.apply(this,arguments)||this}
BeforePreroll._getName=function _getName(){return'BeforePreroll'};var _proto=BeforePreroll.prototype;_proto.init=function init(player){this.adsReady=!1;this.shouldResumeToContent=!1;player.ads._shouldBlockPlay=player.ads.settings.allowVjsAutoplay?!player.autoplay():!0};_proto.onAdsReady=function onAdsReady(player){player.ads.debug('Received adsready event (BeforePreroll)');this.adsReady=!0};_proto.onPlay=function onPlay(player){var Preroll=States.getState('Preroll');player.ads.debug('Received play event (BeforePreroll)');this.transitionTo(Preroll,this.adsReady,this.shouldResumeToContent)};_proto.onAdsCanceled=function onAdsCanceled(player){player.ads.debug('adscanceled (BeforePreroll)');this.shouldResumeToContent=!0};_proto.onAdsError=function onAdsError(){this.player.ads.debug('adserror (BeforePreroll)');this.shouldResumeToContent=!0};_proto.onNoPreroll=function onNoPreroll(){this.player.ads.debug('Skipping prerolls due to nopreroll event (BeforePreroll)');this.shouldResumeToContent=!0};_proto.skipLinearAdMode=function skipLinearAdMode(){var player=this.player;player.trigger('adskip');player.ads.debug('skipLinearAdMode (BeforePreroll)');this.shouldResumeToContent=!0};_proto.onContentChanged=function onContentChanged(){this.init(this.player)};return BeforePreroll}(ContentState$2);States.registerState('BeforePreroll',BeforePreroll);var AdState$2=States.getState('AdState');var Midroll=function(_AdState){_inheritsLoose(Midroll,_AdState);function Midroll(){return _AdState.apply(this,arguments)||this}
Midroll._getName=function _getName(){return'Midroll'};var _proto=Midroll.prototype;_proto.init=function init(player){player.ads.adType='midroll';obj$1.start(player);player.addClass('vjs-ad-loading')};_proto.onAdStarted=function onAdStarted(player){player.removeClass('vjs-ad-loading')};_proto.endLinearAdMode=function endLinearAdMode(){var player=this.player;if(this.inAdBreak()){this.contentResuming=!0;player.addClass('vjs-ad-content-resuming');player.removeClass('vjs-ad-loading');obj$1.end(player)}};_proto.onAdsError=function onAdsError(player){if(this.inAdBreak()){player.ads.endLinearAdMode()}};_proto.cleanup=function cleanup(player){player.removeClass('vjs-ad-loading');player.removeClass('vjs-ad-content-resuming')};return Midroll}(AdState$2);States.registerState('Midroll',Midroll);var AdState$3=States.getState('AdState');var Postroll=function(_AdState){_inheritsLoose(Postroll,_AdState);function Postroll(){return _AdState.apply(this,arguments)||this}
Postroll._getName=function _getName(){return'Postroll'};var _proto=Postroll.prototype;_proto.init=function init(player){this.waitingForAdBreak=!0;player.ads._contentEnding=!0;if(!player.ads.nopostroll_){player.addClass('vjs-ad-loading');var timeout=player.ads.settings.timeout;if(typeof player.ads.settings.postrollTimeout==='number'){timeout=player.ads.settings.postrollTimeout}
this._postrollTimeout=player.setTimeout(function(){player.trigger('adtimeout')},timeout)}else{this.resumeContent(player);var AdsDone=States.getState('AdsDone');this.transitionTo(AdsDone)}};_proto.startLinearAdMode=function startLinearAdMode(){var player=this.player;if(!player.ads.inAdBreak()&&!this.isContentResuming()){player.ads.adType='postroll';player.clearTimeout(this._postrollTimeout);this.waitingForAdBreak=!1;obj$1.start(player)}else{videojs.log.warn('Unexpected startLinearAdMode invocation (Postroll)')}};_proto.onAdStarted=function onAdStarted(player){player.removeClass('vjs-ad-loading')};_proto.endLinearAdMode=function endLinearAdMode(){var _this=this;var player=this.player;var AdsDone=States.getState('AdsDone');if(this.inAdBreak()){player.removeClass('vjs-ad-loading');this.resumeContent(player);obj$1.end(player,function(){_this.transitionTo(AdsDone)})}};_proto.skipLinearAdMode=function skipLinearAdMode(){var player=this.player;if(player.ads.inAdBreak()||this.isContentResuming()){videojs.log.warn('Unexpected skipLinearAdMode invocation')}else{player.ads.debug('Postroll abort (skipLinearAdMode)');player.trigger('adskip');this.abort(player)}};_proto.onAdTimeout=function onAdTimeout(player){player.ads.debug('Postroll abort (adtimeout)');this.abort(player)};_proto.onAdsError=function onAdsError(player){player.ads.debug('Postroll abort (adserror)');if(player.ads.inAdBreak()){player.ads.endLinearAdMode()}else{this.abort(player)}};_proto.onContentChanged=function onContentChanged(player){if(this.isContentResuming()){var BeforePreroll=States.getState('BeforePreroll');this.transitionTo(BeforePreroll)}else if(!this.inAdBreak()){var Preroll=States.getState('Preroll');this.transitionTo(Preroll)}};_proto.onNoPostroll=function onNoPostroll(player){if(!this.isContentResuming()&&!this.inAdBreak()){this.abort(player)}else{videojs.log.warn('Unexpected nopostroll event (Postroll)')}};_proto.resumeContent=function resumeContent(player){this.contentResuming=!0;player.addClass('vjs-ad-content-resuming')};_proto.abort=function abort(player){var AdsDone=States.getState('AdsDone');this.resumeContent(player);player.removeClass('vjs-ad-loading');this.transitionTo(AdsDone)};_proto.cleanup=function cleanup(player){player.removeClass('vjs-ad-content-resuming');player.clearTimeout(this._postrollTimeout);player.ads._contentEnding=!1};return Postroll}(AdState$3);States.registerState('Postroll',Postroll);var ContentState$3=States.getState('ContentState');var ContentPlayback=function(_ContentState){_inheritsLoose(ContentPlayback,_ContentState);function ContentPlayback(){return _ContentState.apply(this,arguments)||this}
ContentPlayback._getName=function _getName(){return'ContentPlayback'};var _proto=ContentPlayback.prototype;_proto.init=function init(player){player.ads._shouldBlockPlay=!1};_proto.onAdsReady=function onAdsReady(player){player.ads.debug('Received adsready event (ContentPlayback)');if(!player.ads.nopreroll_){player.ads.debug('Triggered readyforpreroll event (ContentPlayback)');player.trigger('readyforpreroll')}};_proto.onReadyForPostroll=function onReadyForPostroll(player){var Postroll=States.getState('Postroll');player.ads.debug('Received readyforpostroll event');this.transitionTo(Postroll)};_proto.startLinearAdMode=function startLinearAdMode(){var Midroll=States.getState('Midroll');this.transitionTo(Midroll)};return ContentPlayback}(ContentState$3);States.registerState('ContentPlayback',ContentPlayback);var ContentState$4=States.getState('ContentState');var StitchedContentPlayback=function(_ContentState){_inheritsLoose(StitchedContentPlayback,_ContentState);function StitchedContentPlayback(){return _ContentState.apply(this,arguments)||this}
StitchedContentPlayback._getName=function _getName(){return'StitchedContentPlayback'};var _proto=StitchedContentPlayback.prototype;_proto.init=function init(){this.player.ads._shouldBlockPlay=!1};_proto.onContentChanged=function onContentChanged(){this.player.ads.debug("Received contentchanged event ("+this.constructor._getName()+")")};_proto.startLinearAdMode=function startLinearAdMode(){var StitchedAdRoll=States.getState('StitchedAdRoll');this.transitionTo(StitchedAdRoll)};return StitchedContentPlayback}(ContentState$4);States.registerState('StitchedContentPlayback',StitchedContentPlayback);var AdState$4=States.getState('AdState');var StitchedAdRoll=function(_AdState){_inheritsLoose(StitchedAdRoll,_AdState);function StitchedAdRoll(){return _AdState.apply(this,arguments)||this}
StitchedAdRoll._getName=function _getName(){return'StitchedAdRoll'};var _proto=StitchedAdRoll.prototype;_proto.init=function init(){this.waitingForAdBreak=!1;this.contentResuming=!1;this.player.ads.adType='stitched';obj$1.start(this.player)};_proto.onPlaying=function onPlaying(){};_proto.onContentResumed=function onContentResumed(){};_proto.onAdEnded=function onAdEnded(){this.endLinearAdMode();this.player.trigger('ended')};_proto.endLinearAdMode=function endLinearAdMode(){var StitchedContentPlayback=States.getState('StitchedContentPlayback');obj$1.end(this.player);this.transitionTo(StitchedContentPlayback)};return StitchedAdRoll}(AdState$4);States.registerState('StitchedAdRoll',StitchedAdRoll);var isMiddlewareMediatorSupported$1=obj.isMiddlewareMediatorSupported;var VIDEO_EVENTS=videojs.getTech('Html5').Events;var defaults={timeout:5000,prerollTimeout:undefined,postrollTimeout:undefined,debug:!1,stitchedAds:!1,contentIsLive:undefined,liveCuePoints:!0,allowVjsAutoplay:videojs.options.normalizeAutoplay||!1};var contribAdsPlugin=function contribAdsPlugin(options){var player=this;var settings=videojs.mergeOptions(defaults,options);var videoEvents=[];VIDEO_EVENTS.concat(['firstplay','loadedalldata']).forEach(function(eventName){if(videoEvents.indexOf(eventName)===-1){videoEvents.push(eventName)}});player.on(videoEvents,redispatch);if(!isMiddlewareMediatorSupported$1()){initCancelContentPlay(player,settings.debug)}
player.setTimeout(function(){if(!player.ads._hasThereBeenALoadStartDuringPlayerLife&&player.src()!==''){videojs.log.error('videojs-contrib-ads has not seen a loadstart event 5 seconds '+'after being initialized, but a source is present. This indicates that '+'videojs-contrib-ads was initialized too late. It must be initialized '+'immediately after video.js in the same tick. As a result, some ads will not '+'play and some media events will be incorrect. For more information, see '+'http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html')}},5000);player.on('ended',function(){if(!player.hasClass('vjs-has-started')){player.addClass('vjs-has-started')}});player.on('contenttimeupdate',function(){player.removeClass('vjs-waiting')});player.on(['addurationchange','adcanplay'],function(){if(player.ads.settings.stitchedAds){return}
if(player.hasStarted()){return}
if(player.ads.snapshot&&player.currentSrc()===player.ads.snapshot.currentSrc){return}
if(!player.ads.inAdBreak()){return}
var playPromise=player.play();if(playPromise&&playPromise.catch){playPromise.catch(function(error){videojs.log.warn('Play promise rejected when playing ad',error)})}});player.on('nopreroll',function(){player.ads.debug('Received nopreroll event');player.ads.nopreroll_=!0});player.on('nopostroll',function(){player.ads.debug('Received nopostroll event');player.ads.nopostroll_=!0});player.on('playing',function(){player.ads._cancelledPlay=!1;player.ads._pausedOnContentupdate=!1});player.on('play',function(){player.ads._playRequested=!0});player.one('loadstart',function(){player.ads._hasThereBeenALoadStartDuringPlayerLife=!0});player.on('loadeddata',function(){player.ads._hasThereBeenALoadedData=!0});player.on('loadedmetadata',function(){player.ads._hasThereBeenALoadedMetaData=!0});player.ads=getAds(player);player.ads.settings=settings;settings.stitchedAds=!!settings.stitchedAds;if(settings.stitchedAds){player.ads._state=new(States.getState('StitchedContentPlayback'))(player)}else{player.ads._state=new(States.getState('BeforePreroll'))(player)}
player.ads._state.init(player);player.ads.cueTextTracks=cueTextTracks;player.ads.adMacroReplacement=adMacroReplacement.bind(player);initializeContentupdate(player);player.on('contentchanged',player.ads.reset);var shouldDisableTracks=function shouldDisableTracks(){return!player.ads.shouldPlayContentBehindAd(player)&&player.ads.inAdBreak()&&player.tech_.featuresNativeTextTracks&&videojs.browser.IS_IOS&&!Array.isArray(player.textTracks())};var textTrackChangeHandler=function textTrackChangeHandler(){var textTrackList=player.textTracks();if(shouldDisableTracks()){for(var i=0;i<textTrackList.length;i++){var track=textTrackList[i];if(track.mode==='showing'){track.mode='disabled'}}}};player.ready(function(){player.textTracks().addEventListener('change',textTrackChangeHandler)});player.on(['play','playing','ended','adsready','adscanceled','adskip','adserror','adtimeout','adended','ads-ad-started','contentchanged','dispose','contentresumed','readyforpostroll','nopreroll','nopostroll'],function(e){player.ads._state.handleEvent(e.type)});player.on('dispose',function(){player.ads.reset();player.textTracks().removeEventListener('change',textTrackChangeHandler)});listenToTcf();player.ads.listenToTcf=listenToTcf};contribAdsPlugin.VERSION=version;register(contribAdsPlugin);return contribAdsPlugin}))